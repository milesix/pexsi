% Processing for the poles generated by quad file into a format that can
% be combined into the PoleData.dat in PEXSI
%
% Revision: 02/18/2019

fin = fopen('rawpole_2.dat', 'r');
% fout = fopen('method2.dat', 'w');
fout = fopen('pole_2.dat', 'w');
while(1)
  Npole2 = fscanf(fin,'%d', 1);
  if( isempty(Npole2) )
    break;
  end
  Npole = Npole2/2;
  err = fscanf(fin,'%g', 1);
  Range = fscanf(fin,'%g',1);
  data = fscanf(fin,'%g', Npole2*4);
  data = transpose(reshape(data,4,Npole2));
  zshift = data(1:2:end,3) + 1i * data(1:2:end,4);
  zweight = ((data(1:2:end,1) + 1i * data(1:2:end,2)))*2i;

  % Minimax method for pole expansion
  fprintf('Npole = %d, Range = %25.15e\n', Npole, Range);
  fprintf(fout, '%5d %5d %25.15e\n', 2, Npole, Range);
  for l = 1 : Npole
    fprintf(fout, '%25.15e %25.15e %25.15e %25.15e\n', ...
      real(zshift(l)), imag(zshift(l)), real(zweight(l)), ...
      imag(zweight(l)));
  end
end
fclose(fin);
fclose(fout);
